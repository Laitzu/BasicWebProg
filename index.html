
<html>
<link rel="stylesheet" href="styles.css">
<body onload="getData()">

<!-- 
<h1 id="Header1">Hello World</h1>

<button id="my-button" onclick="changeText()">Test</button>

<ul id="my-list"></ul>
<li id="Element1">Kurkkusalaatti</li>
<li id="Element2"></li>

<button id="add-data" onclick="addElement()">Add</button>

<textarea id="Text1" rows="4" cols="25">Tämä on testi. Testin tarkoituksena on harjoitella erilaisten HTML-tagien käyttöä.</textarea>

<table id="userInfoTable">
    <thead>
        <th>Username</th>
        <th>Email</th>
        <th>Admin</th>
    </thead>
    <tbody>
    <tr>
        <td>Admin_Antero</td>
        <td>Antero@email.com</td>
        <td>true</td>
    </tr>
    <tr>
        <td>Kari_Käyttäjä</td>
        <td>Kari@email.com</td>
        <td>false</td>
    </tr>
    </tbody>
</table>

<input type="text" id="input-username" placeholder="Username">
<input type="text" id="input-email" placeholder="E-mail">
<input type="checkbox" id="checkbox">
<input type="file" id="input-image" onchange="previewFile()">
<img id="user-image" src="" height="64" alt="Image preview...">

<br><button id="submit-data" onclick="addToTable()">Add to Table</button>

<button id="empty-table" onclick="clearTable()">Clear table</button>


-->   

<div class="center">
    <h1 class="center">Employment statistics per municipality in Finland</h1>
    <table id="datatable">
        <thead>
            <th>Municipality</th>
            <th>Population</th>
            <th>Employment amount</th>
            <th>Employment-%</th>
        </thead>
    
        <tbody>
    
        </tbody>
    </table>
</div>







<script>
async function getData() {

    const table = document.getElementById("datatable");

    const url = "https://statfin.stat.fi/PxWeb/sq/4e244893-7761-4c4f-8e55-7a8d41d86eff";
    const data = await fetch(url);
    const dataJSON = await data.json();

    const municipalities = dataJSON.dataset.dimension.Alue.category.label;
    const values = dataJSON.dataset.value;

    const url2 = "https://statfin.stat.fi/PxWeb/sq/5e288b40-f8c8-4f1e-b3b0-61b86ce5c065"
    const data2 = await fetch(url2);
    const data2JSON = await data2.json();

    const values2 = data2JSON.dataset.value;

    let i = 0

    Object.values(municipalities).forEach((index) => {
        let td1 = document.createElement("td");
        let td2 = document.createElement("td");
        let td3 = document.createElement("td");
        let td4 = document.createElement("td");

        td1.innerText = index;
        td2.innerText = Object.values(values)[i];
        td3.innerText = Object.values(values2)[i];

        const employmentPercentage = Math.round((td3.innerText/td2.innerText)*10000)/100
        td4.innerText = employmentPercentage + "%";


        tbody = document.getElementById("datatable").getElementsByTagName("tbody")[0];
        let tr = tbody.insertRow()

        tr.appendChild(td1)
        tr.appendChild(td2)
        tr.appendChild(td3)
        tr.appendChild(td4)


        if (employmentPercentage > 45) {
            td4.parentElement.classList.add("good")
        } else if (employmentPercentage < 25) {
            td4.parentElement.classList.add("bad")
        } else if (i % 2 == 0) {
            td4.parentElement.classList.add("odd")
        } else {
            td4.parentElement.classList.add("even")
        }

        console.log(td4.parentElement)

        tbody.appendChild(tr)
        i = i + 1;
    })
}
</script>



<script>
function previewFile() {
    const preview = document.getElementById("user-image");
    const file = document.getElementById("input-image").files[0];
    const reader = new FileReader();

    reader.onloadend = function () {
        preview.src = reader.result;
    }

    if (file) {
        reader.readAsDataURL(file);
    } else {
        preview.src = "";
  }

}
</script>


<script>
function clearTable() {

    var Table = document.getElementById('userInfoTable');
    Table.innerHTML = '';

    const row = Table.insertRow(0)
    const cell1 = row.insertCell(0);
    const cell2 = row.insertCell(1);
    const cell3 = row.insertCell(2);

    header1 = "Username";
    header2 = "Email";
    header3 = "Admin";

    cell1.innerHTML = header1;
    cell2.innerHTML = header2;
    cell3.innerHTML = header3;

}
</script>

<script>
function addToTable() {
    const user = document.getElementById("input-username").value;
    const email = document.getElementById("input-email").value;
    const adminState = document.getElementById("checkbox").checked;
    const table = document.getElementById("userInfoTable");

    rows = table.rows;
    for (let i = 0; i < rows.length; i++) {
        if(rows[i].cells[0].innerText == user) {
            alert("Username already exists in table, replacing with updated information.")
            rows[i].cells[1].innerHTML = email;
            rows[i].cells[2].innerHTML = adminState;
            return
        }
    }  

    const row = table.insertRow(1);
    const cell1 = row.insertCell(0);
    const cell2 = row.insertCell(1);
    const cell3 = row.insertCell(2);
    
    
    cell1.innerHTML = user;
    cell2.innerHTML = email;
    cell3.innerHTML = adminState;
}
</script>



<script>
function addElement() {
    const list = document.getElementById("my-list");
    const li = document.getElementById("Element1");
    const li2 = document.getElementById("Element2");
    const text = document.getElementById("Text1").value;

    list.appendChild(li)

    li2.textContent = text;

    list.appendChild(li2)

    console.log(list)

}
</script>

<script>
function changeText() {
    console.log("hello world");
    document.getElementById("Header1").innerHTML = "Moi maailma";
}
</script>

</body>
</html>